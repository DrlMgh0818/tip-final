---
// Import FullCalendar and dependencies
import FullCalendar from '@fullcalendar/core';
import dayGridPlugin from '@fullcalendar/daygrid';
import React, { useEffect, useRef } from 'react';

// Import your marquee announcements 
const marqueeFiles = import.meta.glob('/src/content/marquee/*.json', { eager: true });
const marquees = Object.values(marqueeFiles).map(module => module.default);

// Component Definition
export interface Props {
  id?: string;
}

const Calendar = ({ id = 'announcement-calendar' }: Props) => {
  const calendarRef = useRef(null);

  useEffect(() => {
    const calendarEl = calendarRef.current;
    if (calendarEl) {
      const calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: [dayGridPlugin],
        initialView: 'dayGridMonth', // Initial calendar view

        // Transform marquees into events
        events: marquees.flatMap(marquee => {
          const startDate = new Date(marquee.startDate); // Assuming ISO format
          const endDate = marquee.endDate ? new Date(marquee.endDate) : null;

          // Handle all-day events
          if (!startDate.getHours() && !startDate.getMinutes()) { 
            startDate.setDate(startDate.getDate() - 1); // FullCalendar quirk
            if (endDate) endDate.setDate(endDate.getDate() - 1);
          }

          return {
            title: marquee.message,
            start: startDate,
            end: endDate,
          };
        }),
      });
      calendar.render();
    }
  }, []);

  return <div id={id} ref={calendarRef}></div>;
};

export default Calendar;
---